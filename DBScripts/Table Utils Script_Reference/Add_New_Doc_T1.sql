DECLARE @DOCUMENTS VARCHAR(MAX) = 'Misc Closing Documents,Unsigned Documents,EarlyChecks,Misc Checklists,Surplus Documents';
DECLARE @CUST_NAME VARCHAR(255) = '';
DECLARE @LOAN_TYPE_NAME VARCHAR(255) = '';

DECLARE @CURRENT_CUSTID BIGINT;
DECLARE @CURRENT_LOANID BIGINT;

DECLARE @DOCTABLE TABLE (
	ID BIGINT
	,DocumentTypeName VARCHAR(max)
	);
DECLARE @DOCCOUNT BIGINT = 1;
DECLARE @DOCROWCOUNT BIGINT;

SELECT @DOCROWCOUNT = COUNT(1)
FROM @DOCTABLE;

DECLARE @CURRTILDOCID BIGINT;

INSERT INTO @DOCTABLE
SELECT ROW_NUMBER() OVER (
		ORDER BY data
		)
	,data
FROM dbo.function_string_to_table(@DOCUMENTS, ',');

SELECT @DOCROWCOUNT = COUNT(1)
FROM @DOCTABLE;

SELECT @CURRENT_CUSTID = CustomerID FROM [T1].CustomerMasters WHERE CustomerName = @CUST_NAME;
SELECT @CURRENT_LOANID = LoanTypeID FROM [T1].LoanTypeMasters WHERE LoanTypeName = @LOAN_TYPE_NAME;

SET @DOCCOUNT = 1;

WHILE @DOCCOUNT <= @DOCROWCOUNT
BEGIN
	INSERT INTO [T1].DocumentTypeMasters
	SELECT DocumentTypeName
		,DocumentTypeName
		,1
		,GETDATE()
		,GETDATE()
		,0
	FROM @DOCTABLE
	WHERE ID = @DOCCOUNT

	SELECT @CURRTILDOCID = MAX(DocumentTypeID)
	FROM [T1].DocumentTypeMasters;

	INSERT INTO [T1].CustLoanDocMapping
	SELECT @CURRENT_CUSTID
		,@CURRENT_LOANID
		,@CURRTILDOCID
		,GETDATE()
		,GETDATE()
		,1

	SET @DOCCOUNT = @DOCCOUNT + 1;
END